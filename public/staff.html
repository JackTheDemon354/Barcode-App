<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Staff Portal</title>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = 'https://wiklfzmcvmevdwpoofuc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indpa2xmem1jdm1ldmR3cG9vZnVjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2NTk5NTAsImV4cCI6MjA2ODIzNTk1MH0.ph15o1doNO3fE6VSuvRblmwNaC8py9ap6zRfZobAnQQ'; // your real anon key here
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const tableBody = document.getElementById('products');

    // Load all products
    async function loadProducts() {
      const { data, error } = await supabase.from('products').select('*');
      tableBody.innerHTML = ''; // Clear table
      if (error) {
        alert("Failed to load products: " + error.message);
        return;
      }

      for (const product of data) {
        const row = document.createElement('tr');

        row.innerHTML = `
          <td>${product.barcode}</td>
          <td contenteditable="true">${product.name}</td>
          <td contenteditable="true">${product.price}</td>
          <td>
            <button onclick="updateProduct('${product.barcode}', this)">üíæ Save</button>
            <button onclick="deleteProduct('${product.barcode}')">üóëÔ∏è Delete</button>
          </td>
        `;

        tableBody.appendChild(row);
      }
    }

    // Add product
    document.getElementById('add-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const barcode = document.getElementById('barcode').value.trim();
      const name = document.getElementById('name').value.trim();
      const price = document.getElementById('price').value.trim();

      if (!barcode || !name || !price) return alert("Fill all fields!");

      const { error } = await supabase.from('products').insert([{ barcode, name, price }]);
      if (error) return alert("Failed to add product: " + error.message);

      document.getElementById('add-form').reset();
      await loadProducts();
    });

    // Update product
    window.updateProduct = async (barcode, btn) => {
      const row = btn.closest('tr');
      const name = row.children[1].innerText.trim();
      const price = row.children[2].innerText.trim();

      const { error } = await supabase
        .from('products')
        .update({ name, price })
        .eq('barcode', barcode);

      if (error) return alert("Failed to update: " + error.message);
      alert("‚úÖ Updated!");
    };

    // Delete product
    window.deleteProduct = async (barcode) => {
      const ok = confirm("Delete this product?");
      if (!ok) return;

      const { error } = await supabase.from('products').delete().eq('barcode', barcode);
      if (error) return alert("Failed to delete: " + error.message);

      await loadProducts();
    };

    // Load on page load
    loadProducts();
  </script>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
    td[contenteditable] { background: #ffffe0; }
    input, button { padding: 8px; margin: 5px 0; }
    #add-form input { width: calc(100% / 3 - 10px); }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h1>üõí Staff Product Manager</h1>

  <form id="add-form">
    <input id="barcode" placeholder="Barcode" required />
    <input id="name" placeholder="Product Name" required />
    <input id="price" placeholder="Price" required />
    <button type="submit">‚ûï Add Product</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Barcode</th>
        <th>Name</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="products"></tbody>
  </table>
</body>
</html>
